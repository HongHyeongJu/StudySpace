## 유데미 Redis : 개발자를 위한 Redis 완벽 가이드
### ch.04 - Redis 로컬 설정 && ch.05 - 해시 자료 구조

<br>
<br>

### Redis Window 설치
* Redis에는 Redis와 Redis Stack, 두 가지 버전이 있습니다.
  * Redis에는 핵심 Redis데이터베이스가 포함됩니다.
  * Redis Stack에는 핵심 Redis 데이터베이스 그리고 Redis의 기능을 확장해 주는 추가 기능이 포함돼 있습니다.
* Redis Labs에 인스턴스를 생성하면 Redis Stack의 사본을 얻을 수 있으며, 여기에는 이미 설치된 추가 모듈이 있습니다.
* 강의 과정 후반부로 가면 이 추가 모듈을 사용해야 하므로 Redis Stack을 실행해야 합니다.
* 설치 가이드 : https://redis.io/docs/install/install-stack/docker/


<br>

### Redis의 해시
* 해시로 중첩된 키-값 쌍의 모음을 저장할 수 있음
* 해시의 일반적인 사용 사례
  * 애플리케이션의 특정 레코드나 엔터티의 정보를 저장함
* 주의할 점
  해시를 사용해 여러 단계로 중첩된 키-값 쌍은 저장할 수 없음
  * 중첩X 배열X
* JSON 구조와 유사함

<br>


### 해시 저장 및 가져오기
* HSET
  * 첫번째 인수 : 해시 자료구조를 저장할 키 이름
  * 첫번째 인수 다음에는 [키이름, 값]을 반복적으로 작성하기
  * ex) ```HSET company name, 'Company Co', age, 1915```  -> 반환숫자 2 : 2개의 키-값 쌍을 업데이트했다는 의미
* HGET
  * ```HSET company name``` -> 'Company Co' q반환
* HGETALL
  * ```HGETALL company ``` -> ```["name": "Company Co", "age": "1915"]``` 실제로는 배열로 반환함
  * 클라이언트 라이브러리에서는 이와 같은 배열이 반환되므로 직접 키-값 쌍을 오브젝트로 변환해야 할 수 있음
* 필기
* 필기


<br>


### 해시 데이터 삭제하기
* HEXISTS
  * 기존 해시에 키가 정의되어 있는지 확인. 키의 존재만 확인
  * ex) ```HEXISTS company age``` -> 해시안에 age가 있으면 1 반환, 없으면 0 반환
  * 주의점
      * Redis가 저장된 값을 검증하지는 않음. age에 빈 문자열, 0, false등 잘못된 값이 담겨있을 수 있음
* DEL
  * 문자열의 명령어와 동일하게 작동하며 해당 키에 저장된 해시 전체를 삭제함
  * ```DEL company```
* HDEL
  * 해시에 저장된 키-값 쌍 하나를 삭제
  * ```HGETALL company```



<br>


### 해시에서 숫자 다루기
* HINCRBY
  * 해시 내의 숫자에 정수 더하기
  * ```HINCRBY company age 10```
  * 해시 내에 존재하지 않는 키에 HINCRBY를 실행하면 키가 생성됨
  * 음수 값을 전달하면 기존 값에서 뺄 수 있음
* HINCRBYFLOAT
  * 해시 내의 숫자에 실수 더하기
  * ```HINCRBYFLOAT company age 1.005```
* HSTRLEN
  * 해시에 저장된 문자열의 길이를 가져옴
* HKEYS
  * 해시의 모든 키 가져오기
* HVALUES
  * 해시의 모든 값 가져오기


<br>


### HSET와 HGETALL의 예상치 못한 동작
#### HSET 관련 문제
* HSET 명령어에는 키와 값이 번갈아 가며 문자열로 작성되어야 함
* node에서 쿼리 입력 시 오브젝트를 그대로 Redis에 전달하는 게 아니라 node-redis가 오브젝트를 처리한 다음에 전달함
* 이 처리 과정에서 오류가 발생하는 겁니다
  * node-redis가 하는 작업
  * 오브젝트를 받아 Redis가 이해할 수 있는 HSET 명령어로 변환해야 합니다
  * 문자열을 만들기 시작
  * 해시의 키 이름인 car 이후에는 일반적인 HSET 명령어처럼 키와 값을 번갈아 작성 => OK
  * 이제 문자열에 값을 입력할 때 문제가 발생
    * 오브젝트 안의 값을 하나씩 확인해 toString() 메서드를 호출함 (그러나 값 중에 null과 undefined가 있음)
    * 자바스크립트에서 null 또는 undefined의 프로퍼티를 액세스하려고 하면 즉시 터미널에 표시되었던 것과 같은 오류 메시지가 반환 됨
  * node-redis로는 null 값을 저장할 수 없음
* 해결방안
  * 값 없는 속성 삭제
  * null || ''로 정의해서 빈 문자열 넣기

<br>

#### HGETALL 관련 문제
* 이상하게 동작하는 이유 :  HGETALL의 기본적인 특성 때문
* Redis에 존재하지 않는 키에 액세스해 해시를 읽으려고 하면 => 기본적으로 빈 오브젝트를 반환함 {}
* 해결방안
  * ```if(!car){해당 키가 존재하지 않을 때의 동작}``` : if문은 절대 충족될 수 없음
  * 조건을 수정하자! 빈 오브젝트가 반환되었다면 아마 원하던 데이터를 찾지 못했을 것이므로 따라서 car 오브젝트의 길이를 확인하면 됨
  * 길이가 0이라면 빈 오브젝트
  * ```if(Objet.keys(car).length===0){키 존재 안할때 원하는 동작}```
* 정리
  * HSET을 사용할 때는 저장하려는 데이터가 무엇인지 주의해야함.
  * HGETALL을 사용할 때는 존재하지 않는 키를 가져오려고 해도 항상 빈 오브젝트가 반환되므로 확인 시 객체의 길이 확인하기