### K-MOOC 데이터베이스 보안 강의 청강
#### 12주차. 데이터베이스 암호화 설계 및 구축

<br>
<br>

## [ 1-3. 데이터베이스 암호화 설계/구축/운영 ]

<br>

#### 데이터베이스 암호화 설계
* 관련내용 
  * 데이터베이스 사용자 식별
  * 비인가 사용자에 대한 통제
  * 복호화 권한 통제
  * 암호화 대상 선정
  * 암호화 알고리즘 선정
* 사용자 식별 및 비인가 사용자에 대한 통제
  * 사용자 식별 : 암호화 수행 전에 사용자를 식별하여 적절한 사용자에게 암호키를 제공하는 것이 목적
  * 사용자
    * 정형적인 접근 : 특정 업무 수행을 위해 정기적으로 접속해서 반복적인 SQL 작업 수행, ex) 웹 서버, 응용프로그램 등이 해당
    * 비정형적인 접근 : DBMS 유지보수나 개발을 위해 DB에 직접 접속 ex) 데이터베이스 관리자, 애플리케이션 개발자 등이 해당함
  * 추가식별을 통해 정당한 상황에서만 암호 키가 발급, 또는 복호화가 수행되도록 설계하기
* 암호화 대상 선정
  * 특정 컬럼, 또는 데이터베이스 전체 중에서 선정
  * 컬럼 암호화
    * 민감하다고 판단되는 컬럼 선정 : 유출 시 특정 개인을 알아낼 수 있는 개인적인 데이터
    * 장점 : 식별된 사용자마다 적절한 암호화 수행
    * 단점 : 암호화된 컬럼이 인덱스를 가진 경우 인덱스 활용 불가
  * 데이터베이스 전체 암호화
    * 다양한 명칭: 디스크 암호화, 테이블스페이스 암호화, 블록 암호화
    * 비인가 사용자의 데이터 열람 비허용
    * 장점 : 간단한 구현 방식, 비인가자 데이터 확인 불가로 상대적으로 높은 안정성
    * 단점 : 빈번함 암복호화 과정으로 DBMS 부하 발생, 사용자식별 불가로 사용자 관리가 어려움


<br>
<br>


#### 데이터베이스 암호화 구축
* 암호화 설계의 내용을 토대로 실제 데이터베이스에 암호화를 수행하는 단계
  * 제약사항 유지, 원본 데이터 삭제, DB 암호화 키 관리
* 원본 데이터 삭제
  * 데이터베이스 암호화 수행 후, 원본 데이터를 가진 모든 스토리지에 포함된 평문 형태의 데이터 삭제가 필요함
  * 원본데이터를 가진 인덱스 또한 삭제
  * 삭제 시기: 암호화 적용 방식에 따라 구분하기
* 제약사항 유지
  * 원본 데이터가 암호된 이후에도 연관관계를 가지고 있던 인덱스, PK, FK, 유일키, 트리거 등은 그대로 유지하기
  * 인덱스를 가진 컬럼을 암호화 하는 경우 인덱스도 함꼐 암호화 하기, 암호화 되지 않은 별도의 컬럼을 통해 인덱스 가능하도록 구축
* DB 암호화 키 관리
  * 암복호화에 수행된 암호키를 관리하는 것.
  * 관리 방법 
    * 마스터 키 사용 : 장점-상대적으로 안전, 단점-많은 암호키 관리, 안전한 마스터 키 관리 방안 필요 
    * HSM : 마스커티, 암호키 보호를 위해 등장. 내부에서 생성 된 암호키는 유출이 불가능하도록 구성함. 악의적 공격시 스스로 파기 
    * 암호 키에 대한 접근 제어
    * 암호 키 발급 및 폐기 내역 관리 : 적절한 주기에 따라 재 발급, 키 관리 시스템 필요함

<br>
<br>

#### 데이터베이스 암호화 운영
* 암호화 키 변경 이력 및 백업 관리
  * 암호화 키 관리 이유 : 키 유출 시 큰 보안 사고 발생, 분실 시 복호화 불가
  * 여러 암호 키 사용, 주기적인 암호 키 변경, 암호 키 백업 관리
  * Oracle Key Vault
    * 오라클 월렛과 자바 키노트 : 암호 키 관리, 다른 키스토어의 파일 관리 지원
    * 어플리케이션 백업 : 암호 키 분식 시 데이터 복호화를 위한 암호 키 백업 관리
    * TDE
    * 관리콘솔 : 암호 키 발급 이력 등 관리
* 사용자 로그 관리
  * 데이터베이스 관리자는 사용자가 암호화된 데이터에 어떠한 행동을 수행하는지 모니터링
  * 보안 감사 : 사용자 생동을 실시간으로 기록한 정보 필요함
  * Oracle 보안 감사 : 감사 레코드 조회
    * 데이터 사전(감사 레코드 내부 저장 시, SYS.AUD$가 관리함)
    * 감사를 위한 뷰를 제공함
  * 외부 솔루션


<br>
<br>

## [ 4. Oracle DBMS 암호화 ]

<br>

#### 보안 개요
* TDE, 암복호화 메서드
* 데이터베이스 관리 기능
  * 데이터베이스 사용자 관리 : 권한부여, 접근 통제
  * 데이터베이스 자체 보호 : 데이터베이스 암호화
* TDE
  * 암호화 방식 : 컬럼, 테이블 스페이스
  * 데이터베이스 레벨에서 암복호화가 수정되므로 응용프로그램 수정 불필요
  * 암호 알고리즘 : AES, 3DES
  * 암호키 : 테이블키, 스페이스키
  * 실제 데이터 암호화를 수행하는 키가 암호화 되어있음 : 마스터키
  * 마스터 키 관리를 위한 별도 기능 제공 : 오라클 월렛 매니저
* 암복호화 메서드
  * 데이터베이스 암호화 메소드 수행을 위해 DBMS_CRYPTO 패키지 사용
  * 다양한 암호 알고리즘을 패키지 상수로 제공


<br>
<br>


## [ 5. MySQL DBMS 암호화 ]

<br>

#### 개요
* 권한부여를 통한 데이터베이스 사용자 관리, 데이터베이스 암호화를 통한 데이터베이스 자체 보호
* MySQL TDE
  * 부르는 명칭의 차이
    * Oracle : TDE 암호화
    * MySQL : Data-at-Rest Encryption(데이터가 저장된 단계)
  * 마스터 키
    * Oracle : 
      * 암호화 키를 마스터 키로 암호화 하여 데이터베이스에 저장, 
      * 마스터 키만 관리
      * 컬럼 암호화 지원 O
      * 다양한 알고리즘 지원
      * 다양한 블록 암호모드 지원
    * MySQL : 
      * 데이터베이스를 암호한 암호화 키를 테이블에 저장
      * 컬럼 암호화 지원 X
      * AES256 암호 알고리즘만 지원
      * ECB 블록 암호 모드만 지원

<br>
<br>

#### 블록 암호 모드
* 긴 평문을 블록 단위로 암호화 하는 알고리즘을 위한 암호화 운용 방식
* 운용 모드 5가지 : ECB, CBC, CFB, OFB, CTR
* ECB 모드
  * 장점 : 병렬처리 가능, 짧은 암호화 시간
  * 단점 : 키 값 유추 가능함 -> 낮은 안전성
* CBC 모드
  * 암호 블록 연쇄 모드
  * 앞단계에서 암호화 된 블록이 그 다음의 input으로 들어감
* CFB 모드
  * 암호 피드백 모드
  * 한 단계 앞의 암호문 블록을 암호 알고리즘의 입력으로 사용함
  * 평문 블록은 암호화 수행 X
* OFB 모드
  * 출력 피드백 모드
  * 평문블록과 암호 알고리즘의 출력을 XOR 해서 암호문 블록 생성
* CTR 모드
  * 블록을 암호화 할 때마다 1씩 증가해가는 카운터를 암호화 해서 키 스트림을 생성함
* 암복호화 메서드
  * AES 알고리즘과 3DES 알고리즘만 지원함
  * MySQL이 SSL을 지원하도록 설정해야 사용 가능함
  * AES 알고리즘
    * 암복호화를 위한 함수
    * SSL의 종류에 따라 지원하는 블록 암호 운용 모드가 다름
    * 데이터베이스에 데이터를 입력할 때 사용하는 함수
    * ```INSERT INTO table VALUES(1, AES_ENCRYPT('text','password'));```


<br>
<br>



